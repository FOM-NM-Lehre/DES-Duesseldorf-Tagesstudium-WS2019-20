---
title: "Meine ersten Schritte in R (Dozentenversion)"
author: "Norman Markgraf"
date: "16.9.2019"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Wir laden hier das Paket mosaic vor, 
# damit später keine Warnmeldungen ausgegeben werden!
library(mosaic)
```

## Vorlesung vom 16.09.2019

Das ist ein Paragraph, in dem kann ich **fett** und *kursiv* schreiben!

Meine erste Zeile R-Code:

```{r}
43/12+5-14
```


Als erstes lade ich das Paket "mosaic" und danach lade ich die Tabelle "Births78" in den Arbeitsspeicher:

```{r}
library(mosaic)
data("Births78")
```

Wie wollen nun ein Streudiagramm erstellen in dem wir die Anzahl der Geburten (in der Spalte `births`) dem Datum (Spalte `date`) gegenüberstellen:

```{r}
gf_point(births ~ date, data=Births78)
```

Erzeuge ein Streudiagramm mit eingefärbten Wochentagen (`color = ~ wday`):
```{r}
gf_point(births ~ date, color = ~ wday, data=Births78)
```


Wie viele Leute wurden am 4. Juli 1978 in den USA geboren?

```{r}
Births78 %>%   # Nimm den Datensatz "Births78" UND DANN
    filter(date=="1978-07-04") %>%  # Nur Zeilen vom 4.7.78 auswählen UND DANN
    select(births)  # Nimm nur die Spalte "births" und gib das Ergebnis aus.
```


Wie viele Leute wurden am 9. Mai 1978 in den USA geboren?

```{r}
Births78 %>%
    filter(date == "1978-05-09") %>%
    select(births)
```


Wie viele Kinder werden durchschnittlich an einem Tag in den USA im Jahr 1978 geboren?

```{r}
mean(births ~ 1, data=Births78)
```

Alternativ geht auch:

```{r}
mean( ~ births, data=Births78)
```


Wie sieht das über die Woche hin aus?

```{r}
mean(births ~ wday, data=Births78)
```

Wie sieht die Anzahle der Geburten pro Monat aus?

```{r}
mean(births ~ month, data=Births78)
```



## Vorlesung vom 17.09.2019

Als erstes wiederholen wir die folgenden Zeilen:

```{r}
library(mosaic)
data(Births78)
```


Die Struktur des Datensatzes "Births78" erhalten wir wie folgt:

```{r}
str(Births78)
```

Mit dem Befehl `Births78$births` erhalte ich eine Liste aller Geburtenzahlen in der bestehenden Reihenfolge:
```{r}
Births78$births
```

# Explorativer Datenanalyse (Vorlesung 17.9.2019)

Zu Beginn wollen wir EINMAL den Datensatz "tips" aus dem Internet laden, lokal auf ihrem Rechner nur dem Dateinamen "tips.csv" speichern um ihn dann also Datensatz "tips" später nutzen und laden zu können.

```{r}
# Herunterladen der Daten aus dem Internet:
download.file("https://goo.gl/whKjnl", destfile = "tips.csv")
```



Im nächsten Schritt, den wir am Anfang einer jeden Vorlesung wiederholen müssen, laden wir die Daten aus "tips.csv" in den Datensatzvariable "tips":

```{r}
tips <- read.csv2("tips.csv")
```

Ein Datensatz besteht aus verschiedenen Datentypen. Die genaue Struktur können wir wie folgt betrachten:

```{r}
str(tips)
```


## Wir erstellen Säulendiagramme

Darstellung als absolute Häufigkeiten:

```{r}
gf_bar( ~ sex, data=tips)
```

Darstellung als relative Häufigkeiten (als Anteilswerte):
```{r}
gf_props( ~ sex, data=tips)
```

Darstellung als relative Häufigkeiten (als Prozente):
```{r}
gf_percents( ~ sex, data=tips)
```


## Anzeilswerte ausgeben

Wie oft haben Männer bezahlt?
```{r}
prop( ~ sex, success="Male", data=tips)
```

Wie oft haben Frauen bezahlt?
```{r}
prop( ~ sex, success="Female", data=tips)
```

Die absoluten Werte in einer Tabelle (*tally* vom engl. Wort für *Stichliste*)
```{r}
tally( ~ sex, data=tips)
```

Die selbe Information, nun aber als Anzeilswerte:
```{r}
tally( ~ sex, format="proportion", data=tips)
```

## Vorlesung vom 23.9.2019

Zu Beginn laden wir das Paket mosaic und die tips Daten:

```{r}
library(mosaic)
tips <- read.csv2("tips.csv")
```

```{r}
gf_histogram( ~ tip ,data=tips, binwidth= 1, center= 0.5)
```

## Vorlesung vom 1.10.2019

Zu Beginn laden wir das Paket **mosaic** und die *tipping*-Daten:

```{r}
library(mosaic)
tips <- read.csv2("tips.csv")
```


```{r}
inspect(tips)
```

Einen Blick auf die Kennzahlen:

```{r}
favstats( ~ total_bill, data=tips)
```


## Offene Übung 58

- Histogramm
```{r}
gf_histogram( ~ total_bill | smoker, data=tips)
```

- Boxplot
```{r}
gf_boxplot(total_bill ~ smoker, data=tips)
```

- Kennzahlen (allg.)
```{r}
favstats(total_bill ~ smoker, data=tips)
```

- IQR
```{r}
iqr(total_bill ~ smoker, data=tips)
```


## Vorlesung vom 7.10.2019

Zu Beginn laden wir das Paket **mosaic** und die *tipping*-Daten:

```{r}
library(mosaic)
tips <- read.csv2("tips.csv")
```



```{r}
cor(tip ~ total_bill, data=tips)
```

 Erstelle ein lineares Modell für den Zusammenhang von Trinkgeldhöhe (tip) und Rechnungshöhe (total_bill):
 
```{r}
erglm1 <- lm(tip ~ total_bill, data=tips)
erglm1
```
 

```{r}
plotModel(erglm1)
```
 
 
 
 
## Vorlesung vom 15.10.2019

Zu Beginn laden wir das Paket **mosaic** und die *tipping*-Daten:

```{r}
library(mosaic)
tips <- read.csv2("tips.csv")
```


### Übung 84:

```{r}
# Erstellen des multiplen linearen Regressionsmodels
erglmUeb <- lm( total_bill ~ size + time, data= tips)
```

```{r}

# Ausgabe des Modells als Graphik
plotModel(erglmUeb)
```

```{r}

# Zusammenfassung aller Modelinformationen
summary(erglmUeb)
```

```{r}

# Erstellen einer Bootstrap-Verteilung
Bootvtlg <- do(10000) * lm(total_bill ~ size + time, data= resample(tips))
```

```{r}
# Ausgabe der Konfidenzintervalle
confint(Bootvtlg)
```

 
## Vorlesung vom 21.10.2019

Erste Schritte in Richtung Hausarbeit! Dazu laden wir einmal die Tipping-Daten und starten Mosaic:

```{r}
library(mosaic)
tips <- read.csv2("tips.csv")
set.seed(2009)
```

Zunächst schrenken wir die tipping-Daten auf die Variabeln "total_bill", "sex", "smoker", "day", "time", "size" ein:

```{r}
tips %>%
    select(c("total_bill", "sex", "smoker", "day", "time", "size")) -> tips
```

Ziel ist es, den Rechnungsbetrag ("total_bill") auf Grundlage der Werte von "sex", "smoker", "day", "time" und "size" vorherzusagen.

Wir teilen den tipping-Datensatz auf in eine Trainings-Datensatz ("tipstrain"), einem Test-Datensatz ("tipstest") und einem Prüfdatensatz ("tipspruef"). Der Trainingsdatensatz sollte rund 66% der Daten die wir haben umfassen. Der Testdatensatz die restlich ca. 33%

```{r}
# n.train ist ein Index für alle Werte, die wir im Trainingsdatensatz haben wollen
x.train <- sample(1:nrow(tips), floor(2/3*nrow(tips)))
tipstrain <- slice(tips, x.train)
tipspruef <- slice(tips, -(x.train))
tipspruef %>% 
    select(-total_bill) -> tipstest
```


Mit dem Tainingsdatensatz versuchen wir nun ein Prognosemodell zu erstellen.
Mit diesem Modell versuchen wir dann aus dem Testdatensatz eine Prognose für "total_bill" zu erzeugen und vergleichen dies dann (im Wettbewerb macht das der Dozent für die Note!) mit dem Prüfdatensatz.


### Das Nullmodel

```{r}
lm.null <- lm( total_bill ~ 1, data=tipstrain)
summary(lm.null)
```


Das Nullmodell sagt in jedem Fall den Rechnungsbetrag vorher als den Mittelwert

der Trainingsdaten!
```{r}
mean(~ total_bill, data=tipstrain)
```

Nun bestimmte ich für das Testmodell eine Vorhersage:
```{r}
predict.null <- predict(lm.null, newdata=tipstest)
predict.null
```


Im Nullmodell wird dabei jede Vorhersage dem Mittelwert ensprechen!

## Auswertung! (Das macht der Prüfer, nicht sie!)

```{r}
sum( abs( tipspruef$total_bill - predict.null))
```


Jedes Modell, das einen kleiner Wert liefter ist mindesten 4,0!


## Das erste NICHT-Nullmodell

```{r}
lm.versuch1 <- lm( total_bill ~ size, data=tipstrain)
summary(lm.versuch1)
```

Nun bestimmte ich für das Testmodell eine Vorhersage:
```{r}
predict.versuch1 <- predict(lm.versuch1, newdata=tipstest)
#predict.versuch1
```
## Auswertung! (Das macht der Prüfer, nicht sie!)

```{r}
sum( abs( tipspruef$total_bill - predict.versuch1))
```


## Das zweite NICHT-Nullmodell

```{r}
lm.versuch2 <- lm( total_bill ~ size * smoker, data=tipstrain)
summary(lm.versuch2)
```

Nun bestimmte ich für das Testmodell eine Vorhersage:
```{r}
predict.versuch2 <- predict(lm.versuch2, newdata=tipstest)
#predict.versuch2
```
## Auswertung! (Das macht der Prüfer, nicht sie!)

```{r}
sum( abs( tipspruef$total_bill - predict.versuch2))
```

## Das zweite NICHT-Nullmodell

```{r}
lm.versuch3 <- lm( total_bill ~ size + smoker, data=tipstrain)
summary(lm.versuch3)
```

Nun bestimmte ich für das Testmodell eine Vorhersage:
```{r}
predict.versuch3 <- predict(lm.versuch3, newdata=tipstest)
#predict.versuch3
```
## Auswertung! (Das macht der Prüfer, nicht sie!)

```{r}
sum( abs( tipspruef$total_bill - predict.versuch3))
```





